<!DOCTYPE html>
<html>

	<head>
		<title>一定成功业绩管理</title>
		<meta charset="utf-8">

		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- Fonts -->
		<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:300,400' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
		<!-- CSS Libs -->
		<link rel="stylesheet" type="text/css" href="../../lib/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/animate.min.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/bootstrap-switch.min.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/checkbox3.min.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/jquery.dataTables.min.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/dataTables.bootstrap.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/select2.min.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/timedropper.css">
		<link rel="stylesheet" type="text/css" href="../../lib/css/jquery.mloading.css">
		<!-- CSS App -->
		<link rel="stylesheet" type="text/css" href="../../css/style.css">
		<link rel="stylesheet" type="text/css" href="../../css/themes/flat-blue.css">
		<link rel="stylesheet" type="text/css" href="../../css/themes/flat-green.css">
	</head>

	<body class="flat-blue">
		<div class="app-container">
			<div class="row content-container">
				<nav id="navbar" class="navbar navbar-default navbar-fixed-top navbar-top">
					<div class="container-fluid" style="text-align: center;">
						<div class="navbar-header">
							<button type="button" class="navbar-expand-toggle">
                            <i class="fa fa-bars icon"></i>
                        </button>
							<ol class="breadcrumb navbar-breadcrumb">
								<li>添加任务</li>
							</ol>
							<button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                            <i class="fa fa-th icon"></i>
                        </button>
						</div>
						<marquee style="line-height: 60px;width: 50%;display: inline-block;font-size: 20px;color: purple;"></marquee>
						<ul class="nav navbar-nav navbar-right">
							<button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                            <i class="fa fa-times icon"></i>
                        </button>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-comments-o"></i></a>
								<ul class="dropdown-menu animated fadeInDown">
									<li class="title">
										通知 <span class="badge pull-right">0</span>
									</li>
									<li class="message">
										没有新的通知
									</li>
								</ul>
							</li>
							<li class="dropdown danger">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-star-half-o"></i><span class=" totalMsg"></span></a>
								<ul class="dropdown-menu danger  animated fadeInDown">
									<li class="title">
										提示 <span class="badge pull-right totalMsg"></span>
									</li>
									<li>
										<ul class="list-group notifications">
											<a href="../yeji_guanli/yeji_dai_shenhe.html">
												<li class="list-group-item">
													<span class="badge dai_shen_yeji">0</span> <i class="fa fa-exclamation-circle icon"></i> 待审核业绩
												</li>
											</a>
											<a href="../yeji_guanli/zuyuan_yeji.html">
												<li class="list-group-item">
													<span class="badge success zuyuan_yeji">0</span> <i class="fa fa-check icon"></i> 组员业绩
												</li>
											</a>
											<a href="../yeji_guanli/yeji.html">
												<li class="list-group-item">
													<span class="badge danger wode_yeji">0</span> <i class="fa fa-comments icon"></i> 我的业绩
												</li>
											</a>
											<a href="#">
												<li class="list-group-item message">
													敬请期待...
												</li>
											</a>
										</ul>
									</li>
								</ul>
							</li>
							<li class="dropdown profile">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><span class="username"></span> <span class="caret"></span></a>
								<ul class="dropdown-menu animated fadeInDown">
									<li class="profile-img">
										<img src="../../img/profile/picjumbo.com_HNCK4153_resize.jpg" class="profile-img">
									</li>
									<li>
										<div class="profile-info">
											<h4 class="username"></h4>
											<p style="color: red;"><span class="role"></span> ←→ <span class="teamName"></span></p>
											<div class="btn-group margin-bottom-2x" role="group">
												<button type="button" class="btn btn-default headimg_exchange"><i class="fa fa-user"></i> 更换头像</button>
												<button type="button" class="btn btn-default logout"><i class="fa fa-sign-out"></i> 退出登陆</button>
												<input type="file" accept="image/*" style="display: none;" name="headimg_exchange" id="headimg_exchange" />

											</div>
										</div>
									</li>
								</ul>
							</li>
						</ul>
					</div>
				</nav>
				<div id="sidebar" class="side-menu sidebar-inverse">

				</div>
				<div class="container-fluid">
					<div class="side-body">
						<div class="page-title">
							<span class="title">添加任务</span>
							<div class="description"><span class="tips">操作提示</span>:<span class="tips">除了电话,短信,商务通</span>其他需要截图的均属于社区类,请合理选择类型!</div>

							<div class="desctiption">
								<span class="">一:时间选择:</span>
							</div>
							<div><span class="tips">1:时间选择可点击小时,分钟分开选择.</span></div>
							<div class="desctiption">
								<span class="tips">2:时间段必须大于10分钟小于2小时,留信息和自定义任务不做限制,全天可设置,</span>
							</div>
							<div class="desctiption">
								<span class="">二:任务名称:</span><span class="taskName tips"></span>
							</div>
							<div class="desctiption">
								<span class="">三:任务基本数量:</span><span class="taskNum tips"></span>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-12">
								<div class="card">
									<div class="card-header">
										<div class="card-title">
											<div class="title">
												<a class="btn btn-primary" onclick="window.history.go(-1)"><span class="fa fa-chevron-circle-left"></span>任务列表</a>
											</div>
										</div>
									</div>
									<div class="card-body">
										<form class="form-horizontal">
											<div class="form-group">
												<label for="name" class="col-sm-2 control-label">任务</label>
												<div class="col-sm-10">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1"><i>*</i>必填项</span>
														<input type="text" style="width:30%" id="name" class="form-control" aria-describedby="basic-addon1">
													</div>
												</div>
											</div>
											<div class="form-group">
												<label for="num" class="col-sm-2 control-label">数量</label>
												<div class="col-sm-10">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1"><i>*</i>必填项</span>
														<input type="number" style="width:30%" id="num" class="form-control" placeholder="请输入任务数量" aria-describedby="basic-addon1">
													</div>
												</div>
											</div>

											<div class="form-group">
												<label for="starTime" class="col-sm-2 control-label">开始时间</label>
												<div class="col-sm-10">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1"><i>*</i>必填项</span>
														<input type="text" style="width:30%" id="starTime" class="form-control" placeholder="开始时间" aria-describedby="basic-addon1">
													</div>
												</div>
											</div>
											<div class="form-group">
												<label for="endTime" class="col-sm-2 control-label">结束时间</label>
												<div class="col-sm-10">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1"><i>*</i>必填项</span>
														<input type="text" style="width:30%" id="endTime" class="form-control" placeholder="结束时间" aria-describedby="basic-addon1">
													</div>
												</div>
											</div>
											<div class="form-group" id="type">
												<label for="diseasesBox" class="col-sm-2 control-label">任务类型</label>
												<div class="col-sm-10">
													<div class="input-group">
														<span class="input-group-addon" id=""><i>*</i>必填项</span>
														<div>
															<select id="diseasesBox" style="width:30%" title="类型" aria-describedby="">
																<optgroup class="diseasesBox">
																	<option value="link">
																		链接类
																	</option>
																	<option value="social">
																		社区类
																	</option>
																	<option value="commun">
																		通讯类
																	</option>
																	<option value="patient">
																		留信息
																	</option>
																</optgroup>
															</select>
														</div>

													</div>
												</div>
											</div>
											<div class="form-group">
												<div class="col-sm-10 col-sm-offset-2">
													<button type="button" class="btn btn-primary btn-lg save" style="width:100%">提交</button>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
			<footer class="app-footer">
				<div class="wrapper">
					<span class="pull-right">1.0 <a href="#"><i class="fa fa-long-arrow-up"></i></a></span> © 2017 Copyright. 期待更多
					<a href="http://http://www.bj11ss.com/" target="_blank" title="医来伸手">顺昌盛世</a>
					<a href="http://www.bj11ss.com/" title="医来伸手" target="_blank">----医来伸手</a>
				</div>
			</footer>
			<div>
				<!-- Javascript Libs -->
				<script type="text/javascript" src="../../lib/js/jquery.min.js"></script>
				<script type="text/javascript" src="../../lib/js/bootstrap.min.js"></script>
				<script type="text/javascript" src="../../lib/js/Chart.min.js"></script>
				<script type="text/javascript" src="../../lib/js/bootstrap-switch.min.js"></script>
				<script type="text/javascript" src="../../lib/js/timedropper.js"></script>

				<script type="text/javascript" src="../../lib/js/jquery.matchHeight-min.js"></script>
				<script type="text/javascript" src="../../lib/js/jquery.dataTables.min.js"></script>
				<script type="text/javascript" src="../../lib/js/dataTables.bootstrap.min.js"></script>
				<script type="text/javascript" src="../../lib/js/select2.full.min.js"></script>
				<!--<script type="text/javascript" src="../../lib/js/ace/ace.js"></script>
				<script type="text/javascript" src="../../lib/js/ace/mode-html.js"></script>
				<script type="text/javascript" src="../../lib/js/ace/theme-github.js"></script>-->
				<script type="text/javascript" src="../../lib/js/jquery.mloading.js"></script>
				<!--<script src="../../js/loading_start.js"></script>-->
				<!-- Javascript -->
				<script type="text/javascript" src="../../js/app.js"></script>
				<script type="text/javascript" src="../../js/theming.js"></script>
				<script type="text/javascript" src="../../js/themings.js"></script>

				<script src="../../js/config.js"></script>
				<script src="../../js/uploadImg.js"></script>
				<script src="../../js/session_expire.js"></script>
				<script type="text/javascript" src="../../js/personal_msg.js"></script>
				<!-- Javascript -->
				<script type="text/javascript">
					$(function() {
						var search = window.location.search;
						if(search != "") {
							$("#type").css("display", "none");
							var taskId = search.split("taskId=")[1].split("&")[0];
							var taskNum = search.split("taskNum=")[1].split("&")[0];
							var taskName = search.split("taskName=")[1].split("&")[0];
							if(search.split("taskType=")[1]){
								var taskType = search.split("taskType=")[1].split("&")[0];
							}	
							if(search.split("teamTaskId=")[1] && search.split("teamTaskId=")[1].split("&")[0] != "0") {
								var teamTaskId = search.split("teamTaskId=")[1].split("&")[0];
							} else {
								var teamTaskId = "";
							}
							if(search.split("starTime=")[1]) {
								var starTime = search.split("starTime=")[1].split("&")[0];
								var endTime = search.split("endTime=")[1].split("&")[0];
								$("#starTime").val(starTime);
								$("#endTime").val(endTime);
							}

							$(".taskName").text(decodeURI(taskName));
							$(".taskNum").text(taskNum);
							$("#num").val(taskNum);
							$("#name").val(decodeURI(taskName)).attr("disabled", "disabled");

						} else {

							$("#endTime").val("");
							$("#starTime").val("");
						}
						$("#starTime").timeDropper({
							format: "HH:mm",
							meridians: false,
							setCurrentTime: false,

						});
						$("#endTime").timeDropper({
							format: "HH:mm",
							meridians: false,
							setCurrentTime: false,

						});

						//自定义添加任务代码
						/*var search = window.location.search;
						if(search != "") {
							var teamTaskId = window.location.search.split("teamTaskId=")[1].split("&")[0];
							var taskId = window.location.search.split("taskId=")[1].split("&")[0];
							var starTime = window.location.search.split("starTime=")[1].split("&")[0];
							var endTime = window.location.search.split("endTime=")[1].split("&")[0];
							var taskName = window.location.search.split("taskName=")[1].split("&")[0];
							var taskNum = window.location.search.split("taskNum=")[1].split("&")[0];
							$("#name").val(decodeURI(taskName));
							$("#num").val(taskNum);

							$("#starTime").val(starTime);
							$("#endTime").val(endTime);
						} else {
							$("#endTime").val("");
							$("#starTime").val("");
						}*/
						function timeToStamp(starTime, endTime) {
							var minTime = 10;
							var maxTime = 2 * 60;
							var startStamp = (starTime.split(":")[0] * 60 - 0) + (starTime.split(":")[1] - 0);
							var endStamp = (endTime.split(":")[0] * 60 - 0) + (endTime.split(":")[1] - 0);
							if(startStamp > endStamp) {
								alert("开始时间不能大于结束时间!");
								return false;
							}else if(taskType=="patient"){
								return true;
							} else if(!taskId||taskId=="0"){
								return true;
							}else if(endStamp - startStamp < minTime) {
								alert("时间间隔最少为10分钟!");
								return false;
							} else if(endStamp - startStamp > maxTime) {
								alert("时间间隔最多为两小时!");
								return false;
							} else {
								return true;
							}

						}
						$(".save").on("click", function() {
							$("body").mLoading("show"); //显示loading组件				
							//数量
							var num = $("#num").val();
							if(num == "") {
								alert("请输入任务数量!");
								$("body").mLoading("hide"); //关闭loading组件
								return;
							} else if(num < taskNum) {
								alert("设置的基本任务数量为" + taskNum + "请重设!");
								$("#num").val("");
								$("#num").focus();
								$("body").mLoading("hide"); //关闭loading组件
								return;
							}
							var starTime = $("#starTime").val();
							if(starTime == "") {
								alert("请选择开始时间!");
								$("body").mLoading("hide"); //关闭loading组件
								return;
							}
							var endTime = $("#endTime").val();
							if(endTime == "") {
								alert("请选择结束时间!");
								$("body").mLoading("hide"); //关闭loading组件
								return;
							}
							if(timeToStamp(starTime, endTime)) {
								/*在这里调用上传接口*/
								if(taskId == undefined) {
									//自定义添加任务代码
									//任务
									var name = $("#name").val();
									if(name == "") {
										alert("请输入任务名字!");
										return;
									}
									//类型
									var type = $("#diseasesBox").val();
									$.ajax({
										url: config.rootUrl + "user/addTeamTask.do",
										data: {
											deviceToken: "html5",
											deviceType: "html5",
											userId: session_login.info.userId,

											teamId: session_login.info.teamId,
											starTime: starTime,
											endTime: endTime,
											taskName: name,
											taskNum: num,
											taskType: type,
										},
										async: true,
										type: 'post',
										success: function(data) {
											if(data.code == 1) {
												alert("添加任务成功");
												window.history.go(-1);
											} else {
												alert(data.msg);
											}
										},
										error: function(xhr, type, errorThrown) {
											alert('网络异常，请稍后再试！');
										},
										complete: function() {
											$("body").mLoading("hide"); //关闭loading组件
										}
									});
								} else {
									$.ajax({
										url: config.rootUrl + "user/addTeamTask.do",
										data: {
											deviceToken: "html5",
											deviceType: "html5",
											userId: session_login.info.userId,

											teamId: session_login.info.teamId,
											starTime: starTime,
											endTime: endTime,
											taskNum: num,
											taskId: taskId,
											teamTaskId: teamTaskId,
										},
										async: true,
										type: 'post',
										success: function(data) {
											if(data.code == 1) {
												alert(data.msg);
												window.history.go(-1);
											} else {
												alert(data.msg);

											}
										},
										error: function(xhr, type, errorThrown) {
											alert('网络异常，请稍后再试！');
										},
										complete: function() {
											$("body").mLoading("hide"); //关闭loading组件
										}
									});
								}
							}else{
								$("body").mLoading("hide"); //关闭loading组件
							}

						})

					})
				</script>
	</body>

</html>