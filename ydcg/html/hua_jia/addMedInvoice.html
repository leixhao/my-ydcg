<!DOCTYPE html>
<html>

<head>
    <title>划价系统</title>
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
    <!-- CSS Libs -->
    <link rel="stylesheet" type="text/css" href="../../lib/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/bootstrap-switch.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/checkbox3.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/dataTables.bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/jquery.mloading.css">
    <!-- CSS App -->
    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link rel="stylesheet" type="text/css" href="../../css/themes/flat-blue.css">
    <link rel="stylesheet" type="text/css" href="../../css/themes/flat-green.css">
    <style>
        #medicine span {
            font-size: 14px;
        }

        .item {
            padding: 0;
            margin-top: 5px;
        }

        .date {
            text-align: right;
        }

        .flag {
            text-decoration: underline;
        }

        /*input::-webkit-outer-spin-button,*/
        /*input::-webkit-inner-spin-button {*/
            /*!* display: none; <- Crashes Chrome on hover *!*/
            /*-webkit-appearance: none;*/
            /*margin: 0; !* <-- Apparently some margin are still there even though it's hidden *!*/
        /*}*/
    </style>
</head>

<body class="flat-blue">
<div class="app-container">
    <div class="row content-container">
        <nav id="navbar" class="navbar navbar-default navbar-fixed-top navbar-top">
            <div class="container-fluid" style="text-align: center;">
                <div class="navbar-header">
                    <button type="button" class="navbar-expand-toggle">
                        <i class="fa fa-bars icon"></i>
                    </button>
                    <ol class="breadcrumb navbar-breadcrumb">
                        <li>处方单详情</li>
                    </ol>

                </div>
                <ul class="nav navbar-nav navbar-right">
                    <button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                        <i class="fa fa-times icon"></i>
                    </button>
                    <li class="dropdown danger">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                           aria-expanded="false"><i class="fa fa-star-half-o"></i><span
                                class=" totalMsg"></span></a>
                    </li>
                    <li class="dropdown profile">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                           aria-expanded="false"><span class="username"></span> <span class="caret"></span></a>
                        <ul class="dropdown-menu animated fadeInDown">
                            <li class="profile-img">
                            </li>
                            <li>
                                <div class="profile-info">
                                    <h4 class="username"></h4>
                                    <p style="color: red;"><span class="role"></span> ←→ <span
                                            class="teamName"></span></p>
                                    <div class="btn-group margin-bottom-2x" role="group">
                                        <button type="button" class="btn btn-default headimg_exchange"><i
                                                class="fa fa-user"></i> 更换头像
                                        </button>
                                        <button type="button" class="btn btn-default logout"><i
                                                class="fa fa-sign-out"></i> 退出登陆
                                        </button>
                                        <input type="file" accept="image/*" style="display: none;"
                                               name="headimg_exchange" id="headimg_exchange"/>

                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <div id="sidebar" class="side-menu sidebar-inverse">

        </div>
        <div class="container-fluid">
            <div class="side-body">
                <div class="page-title">
                    <span class="title">发药单填写</span>
                    <div class="description">请确定该药单属于本战区所有！</div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="card" id="print-area">
                            <div class="card-header">
                                <div class="card-title">
                                    <a class="btn btn-primary" onclick="window.history.go(-1)"><span
                                            class="fa fa-chevron-circle-left"></span>返回</a>
                                </div>
                            </div>
                            <div class="card-body">
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">药品发出门诊</label>
                                        <div class="col-sm-3 col-xs-3">
                                            <select id="selectSup" style="width:100%" title="门诊">
                                                <optgroup label="门诊(不选默认划价门诊)" class="medicineSupplier">
                                                </optgroup>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="keshi" class="col-sm-2 control-label">科室</label>
                                            <div class="col-sm-3 col-xs-3">
                                                <select id="keshi" style="width: 100%;" title="科室">
                                                    <optgroup label="请选择科室" class="keshi">
                                                    </optgroup>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="receiveName" class="col-sm-2 control-label">收件人</label>
                                        <div class="col-sm-10">
                                            <div class="input-group">
                                                <input type="text" id="receiveName" class="form-control" placeholder="请输入收件人姓名"
                                                       aria-describedby="">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="receivePhone" class="col-sm-2 control-label">收件人联系电话</label>
                                        <div class="col-sm-10">
                                            <input type="text" id="receivePhone" class="form-control" placeholder="请输入收件人联系电话">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">收件人所属</label>
                                        <div class="col-sm-2 col-xs-2">
                                            <div>
                                                <select id="country" class="col-sm-12" title="">
                                                    <optgroup label="请选择" class="country">
                                                        <option value="domestic" selected>国内</option>
                                                        <option value="abroad">国外</option>
                                                    </optgroup>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group gn">
                                        <label  class="col-sm-2 control-label">收件人地址</label>
                                        <div class="col-sm-10">
                                            <div class="form-group">
                                                <div class="col-sm-3 col-xs-3">
                                                    <select name="input_province" id="input_province" class="form-control">
                                                        <option value="">--请选择--</option>
                                                    </select>
                                                </div>
                                                <div class="col-sm-3 col-xs-3">
                                                    <select name="input_city" id="input_city" class="form-control">
                                                        <option value=""></option>
                                                    </select>
                                                </div>
                                                <div class="col-sm-3 col-xs-3 input_area">
                                                    <select name="input_area" id="input_area" class="form-control">
                                                        <option value=""></option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <textarea placeholder="收件人详细地址" class="form-control" id="receiveStreet" style="width:100%"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group gw" style="display: none">
                                        <label  class="col-sm-2 control-label">收件人地址</label>
                                        <div class="col-sm-10">
                                            <div class="form-group">
                                                <div class="col-sm-3 col-xs-3">
                                                    <div class="input-group">
                                                        <input type="text" id="input_province1" class="form-control" placeholder="请输入收件人国家"
                                                               aria-describedby="">
                                                    </div>
                                                </div>
                                                <div class="col-sm-3 col-xs-3">
                                                    <div class="input-group">
                                                        <input type="text" id="input_city1" class="form-control" placeholder="请输入收件人省或州"
                                                               aria-describedby="">
                                                    </div>
                                                </div>
                                                <div class="col-sm-3 col-xs-3">
                                                    <div class="input-group">
                                                        <input type="text" id="input_area1" class="form-control" placeholder="请输入收件人所在市"
                                                               aria-describedby="">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <textarea placeholder="收件人详细地址" class="form-control" id="receiveStreet1" style="width:100%"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sendName" class="col-sm-2 control-label"  style="color:red;">发件人</label>
                                        <div class="col-sm-10">
                                            <div class="input-group">
                                                <input type="text" id="sendName" class="form-control" placeholder="请输入发件人姓名"
                                                       aria-describedby="">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sendPhone" class="col-sm-2 control-label"  style="color:red;">发件人联系电话</label>
                                        <div class="col-sm-10">
                                            <input type="text" id="sendPhone" class="form-control" placeholder="请输入发件人联系电话">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label  class="col-sm-2 control-label" style="color:red;">发件人地址</label>
                                        <div class="col-sm-10">
                                            <div class="form-group">
                                                <div class="col-sm-3 col-xs-3">
                                                    <select name="fa_input_province" id="fa_input_province" class="form-control">
                                                        <option value="">--请选择--</option>
                                                    </select>
                                                </div>
                                                <div class="col-sm-3 col-xs-3">
                                                    <select name="fa_input_city" id="fa_input_city" class="form-control">
                                                        <option value=""></option>
                                                    </select>
                                                </div>
                                                <div class="col-sm-3 col-xs-3">
                                                    <select name="fa_input_area" id="fa_input_area" class="form-control">
                                                        <option value=""></option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <select name="sendStreet1" id="sendStreet1" class="form-control">
                                                    <option value="">--请选择详细地址--</option>
                                                    <option value="清河三街72号 北京福寿堂门诊部"> 清河三街72号 北京福寿堂门诊部</option>
                                                    <option value="天通苑西三区二号北京汉医园中医"> 天通苑西三区二号北京汉医园中医</option>
                                                    <option value="清河小营桥北200米仁爱堂国医馆"> 清河小营桥北200米仁爱堂国医馆</option>
                                                    <option value="天通苑东三区36号北京太壹园中医 "> 天通苑东三区36号北京太壹园中医 </option>
                                                </select>
                                            </div>
                                            <span style="color: red">若以上选择框没有您的详细地址，请在下面填写(若两个都填写，以下面自己填写的详细地址为准)</span>
                                            <div class="col-sm-12">
                                                <textarea placeholder="发件人详细地址" class="form-control" id="sendStreet" style="width:100%"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="paidTime" class="col-sm-2 control-label">付款日期</label>
                                        <div class="col-sm-3">
                                            <input type="date" id="paidTime" class="form-control">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label  class="col-sm-2 control-label">发药情况</label>
                                        <div class="col-sm-2">
                                            <input type="number" id="sendNums" class="form-control" placeholder="总共发几次药" onmousewheel="return false;">
                                        </div>
                                        <div class="col-sm-2">
                                            <input type="number" id="sendCount" class="form-control" placeholder="这是第几次发药" onmousewheel="return false;">
                                        </div>
                                        <div class="col-sm-2">
                                            <input type="number" id="paidMoney" class="form-control" placeholder="已付多少（元）" onmousewheel="return false;">
                                        </div>
                                        <div class="col-sm-2">
                                            <input type="number" id="unPaidMoney" class="form-control"  placeholder="到付多少（元）" onmousewheel="return false;">
                                        </div>
                                    </div>
                                    <div class="form-group caoyao">
                                        <label  class="col-sm-2 control-label">草药总副数</label>
                                        <div class="col-sm-4">
                                            <input type="number" id="detailNum" class="form-control" placeholder="若有草药，请填写草药总副数"
                                                   aria-describedby="" onmousewheel="return false;">
                                        </div>副
                                    </div>
                                    <div class="form-group tangyao">
                                        <label  class="col-sm-2 control-label">汤药总袋数</label>
                                        <div class="col-sm-4">
                                            <input type="number" id="decoctionNum" class="form-control" placeholder="若有汤药，请填写汤药总袋数"
                                                   aria-describedby="" onmousewheel="return false;">
                                        </div>袋
                                    </div>
                                    <div class="form-group tangyao">
                                        <label  class="col-sm-2 control-label">汤药每袋毫升量</label>
                                        <div class="col-sm-4">
                                            <input type="number" id="decoctionMl" class="form-control" placeholder="请填写汤药每袋毫升量(选填)"
                                                   aria-describedby="" onmousewheel="return false;">
                                        </div>mL/袋
                                    </div>
                                    <div class="form-group fenji">
                                        <label  class="col-sm-2 control-label">内服粉剂总支数</label>
                                        <div class="col-sm-4">
                                            <input type="number" id="powderNum" class="form-control" placeholder="若有粉剂，请填写所发粉剂总数(选填)"
                                                   aria-describedby="" onmousewheel="return false;">
                                        </div>支
                                    </div>
                                    <div class="form-group wfenji">
                                        <label  class="col-sm-2 control-label">外敷粉剂总包数</label>
                                        <div class="col-sm-4">
                                            <input type="number" id="outpowderNum" class="form-control" placeholder="若有外敷粉剂，请填写所发外敷粉剂总数(选填)"
                                                   aria-describedby="" onmousewheel="return false;">
                                        </div>包
                                    </div>
                                    <div class="form-group">
                                        <label for="payment" class="col-sm-2 control-label">邮寄方式</label>
                                        <div class="col-sm-10">
                                            <input type="text" id="payment" class="form-control" placeholder="到付或者填写代付金额">
                                        </div>
                                    </div>
                                    <!--快递单-->
                                    <!--<div class="form-group">-->
                                        <!--<label for="payment" class="col-sm-2 control-label">快递单号</label>-->
                                        <!--<div class="col-sm-10">-->
                                            <!--<input type="number" id="danhao" class="form-control" placeholder="快递单号">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <div class="form-group">
                                        <label for="remark" class="col-sm-2 control-label">备注</label>
                                        <div class="col-sm-10">
                                            <textarea class="form-control" id="remark" placeholder="请输入备注信息	" rows="3"></textarea>
                                        </div>

                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">发药</label>
                                        <div class="col-sm-10">
                                            <button type="button" class="btn btn-success btn-lg save" style="width:100%">确认发药</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="app-footer">
        <div class="wrapper">
            <span class="pull-right">1.0 <a href="#"><i class="fa fa-long-arrow-up"></i></a></span> © 2017 Copyright.
            期待更多
            <a href="http://http://www.bj11ss.com/" target="_blank" title="医来伸手">顺昌盛世</a>
            <a href="http://www.bj11ss.com/" title="医来伸手" target="_blank">----医来伸手</a>
        </div>
    </footer>
    <div>
        <!-- Javascript Libs -->
        <script type="text/javascript" src="../../lib/js/jquery.min.js"></script>
        <script type="text/javascript" src="../../lib/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../lib/js/Chart.min.js"></script>
        <script type="text/javascript" src="../../lib/js/bootstrap-switch.min.js"></script>

        <script type="text/javascript" src="../../lib/js/jquery.matchHeight-min.js"></script>
        <script type="text/javascript" src="../../lib/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="../../lib/js/dataTables.bootstrap.min.js"></script>
        <script type="text/javascript" src="../../lib/js/select2.full.min.js"></script>
        <script type="text/javascript" src="../../lib/js/jquery.mloading.js"></script>

        <!-- Javascript -->
        <script type="text/javascript" src="../../js/app.js"></script>
        <script type="text/javascript" src="../../js/theming.js"></script>
        <script type="text/javascript" src="../../js/themings.js"></script>
        <script src="../../js/address.js"></script>
        <script src="../../js/config.js"></script>
        <script src="../../js/uploadImg.js"></script>
        <script src="../../js/session_expire.js"></script>
        <script src="../../js/dateFormat.js"></script>
        <script type="text/javascript" src="../../js/personal_msg.js?"></script>
        <script type="text/javascript" src="../../js/getBaseData.js?"></script>
        <!-- Javascript -->
        <script type="text/javascript">
            $(function () {
                $(".yaoji_zhi").css("line-height","30px");

                var search = window.location.search;
                if (search != "" && search.split("mrId=")[1]) {
                    var mrId = search.split("mrId=")[1].split("&")[0];
                }
                var sexNeed,dName,illness,detail,discountNeed,discountMoney,decoctMoney,medicineCost,patientName,doctorId,doctorName,hospName,hospId,
                    decoction,decoctionCost,decoctionMoney,days,giveDay,herbalCost,herbalMoney,medicineCost,medicineMoney,powder,powderCost,powderMoney,type;
                //获取门诊
                var retSupplier = "";
                function getmedicineSupplier() {
                    if (sessionStorage.getItem("getHospital")) {
                        var medicineSup = JSON.parse(sessionStorage.getItem("getHospital"));
                        for (var i in medicineSup) {
                            var _option = "<option value='" + medicineSup[i].hospId + "'>" + medicineSup[i].hospName + "</option>";
                            retSupplier += _option;
                        }
                        $(".medicineSupplier")[0].innerHTML = retSupplier;
                        $("#selectSup").val(hospId).select2({
                            placeholder: "门诊(不选默认划价门诊)"
                        });
                    } else {
                        $("body").mLoading("show");
                        $.ajax({
                            url: config.rootUrl + "user/getHospital.do",
                            data: {
                                deviceToken: "html5",
                                deviceType: "html5",
                                userId: session_login.info.userId,
                            },
                            async: true,
                            type: 'post',
                            success: function (data) {
                                //添加选项内容
                                var info = data.info;
                                sessionStorage.setItem("getHospital", JSON.stringify(info));
                                //收款账户
                                for (var i in info) {
                                    var _option = "<option value='" + info[i].hospId + "'>" + info[i].hospName + "</option>";
                                    retSupplier += _option;
                                }
                                $(".medicineSupplier")[0].innerHTML = retSupplier;
                                $("#selectSup").val(hospId).select2({
                                    placeholder: "门诊(不选默认划价门诊)"
                                });
                            },
                            error: function (xhr, type, errorThrown) {
                                alert('发生错误！');
                            },
                            complete: function () {
                                $("body").mLoading("hide");//关闭loading组件
                            }
                        });
                    }
                }
                //选择门诊
                $('#selectSup').on("select2:close", function () {
                    hospId = $(this).val();
                    hospName =$(this).find("option:selected").text();
                    console.log(hospId)
                    console.log(hospName)
                })
                //选择收件人所属
                $("#country").val("domestic");
                console.log($("#country").val());
                $('#country').on("select2:close", function () {
                    country = $(this).val();
                    console.log(country);
                    if(country == "domestic"){
                        $(".gn").css("display","block");
                        $(".gw").css("display","none");
                    }else if(country == "abroad"){
                        $(".gw").css("display","block");
                        $(".gn").css("display","none");
                    }
                })

                //获取科室
                getDepart();
                function getDepart() {
                    $.ajax({
                        url: config.rootUrl + "user/getDepart.do",
                        data: {
                            deviceToken: "html5",
                            deviceType: "html5",
                            userId: session_login.info.userId,
                        },
                        async: true,
                        type: 'post',
                        success: function(data) {
                            console.log(data)
                            //添加选项盒子
                            var keshi = $(".keshi");
                            //添加选项内容
                            var info = data.info;
                            for(var i in info) {
                                var _option = document.createElement("option");
                                _option.value = info[i].departId;
                                _option.text = info[i].departName;
                                keshi.append(_option);
                            }
                        },
                        error: function(xhr, type, errorThrown) {
                            alert('网络异常，请稍后再试！');
                        },
                        complete: function() {
                            $('#keshi').val("").select2({
                                placeholder: "请选择科室"
                            });
                        }
                    });
                }
                //三级联动省市区选择框
                var html = "";
                $("#input_city").append(html);
                $("#input_area").append(html);
                $.each(pdata, function(idx, item) {
                    if(parseInt(item.level) == 0) {
                        html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                    }
                });
                $("#input_province").append(html);
                $("#input_province").change(function() {
                    if($(this).val() == "") return;
                    $("#input_city option").remove();
                    $("#input_area option").remove();
                    var code = $(this).find("option:selected").attr("exid");
                    code = code.substring(0, 2);
                    var html = "<option value=''>--请选择--</option>";
                    $("#input_area").append(html);
                    $.each(pdata, function(idx, item) {
                        if(parseInt(item.level) == 1 && code == item.code.substring(0, 2)) {
                            html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                        }
                    });
                    $("#input_city").append(html);
                });
                $("#input_city").change(function() {
                    if($(this).val() == "") return;
                    $("#input_area option").remove();
                    var code = $(this).find("option:selected").attr("exid");
                    code = code.substring(0, 4);
                    var html = "<option value=''>--请选择--</option>";
                    $.each(pdata, function(idx, item) {
                        if(parseInt(item.level) == 2 && code == item.code.substring(0, 4)) {
                            html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                        }
                    });
                    $("#input_area").append(html);
                });
                //三级联动结束


                //发件人三级联动省市区选择框
                var html2 = "";
                $("#fa_input_city").append(html);
                $("#fa_input_area").append(html);
                $.each(pdata, function(idx, item) {
                    if(parseInt(item.level) == 0) {
                        html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                    }
                });
                $("#fa_input_province").append(html);
                $("#fa_input_province").change(function() {
                    if($(this).val() == "") return;
                    $("#fa_input_city option").remove();
                    $("#fa_input_area option").remove();
                    var code = $(this).find("option:selected").attr("exid");
                    code = code.substring(0, 2);
                    var html = "<option value=''>--请选择--</option>";
                    $("#fa_input_area").append(html);
                    $.each(pdata, function(idx, item) {
                        if(parseInt(item.level) == 1 && code == item.code.substring(0, 2)) {
                            html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                        }
                    });
                    $("#fa_input_city").append(html);
                });
                $("#fa_input_city").change(function() {
                    if($(this).val() == "") return;
                    $("#fa_input_area option").remove();
                    var code = $(this).find("option:selected").attr("exid");
                    code = code.substring(0, 4);
                    var html = "<option value=''>--请选择--</option>";
                    $.each(pdata, function(idx, item) {
                        if(parseInt(item.level) == 2 && code == item.code.substring(0, 4)) {
                            html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                        }
                    });
                    $("#fa_input_area").append(html);
                });
                //三级联动结束
                //请求划价详情
                $.ajax({
                    url: config.rootUrl + "user/medRecordDetail.do",
                    data: {
                        deviceToken: "html5",
                        deviceType: "html5",
                        userId: session_login.info.userId,
                        mrId: mrId,
                    },
                    async: true,
                    type: "post",
                    success: function (data) {
                        console.log(data);
                        var info = data.info;
                        var tbody = $(".table tbody")[0];
                        //添加选项盒子
                        hospId=info.hospId;
                        hospName=info.hospName;
                        sexNeed=info.sex;
                        doctorId=info.doctorId;
                        doctorName=info.doctorName;
                        dName=info.dName;
                        illness=info.illness;
                        detail=info.detail;
                        discountNeed=info.discount;
                        discountMoney=info.discountMoney||info.oldMoney;
                        decoctMoney=info.decoctMoney;
                        medicineCost=info.medicineCost;
                        patientName=info.patientName;
                        decoction=info.decoction;
                        decoctionCost=info.decoctionCost;
                        decoctionMoney=info.decoctionMoney;
                        giveDay=info.giveDay;
                        herbalCost=info.herbalCost;
                        herbalMoney=info.herbalMoney;
                        medicineCost=info.medicineCost;
                        medicineMoney=info.medicineMoney;
                        powder=info.powder;
                        powderDay=info.powderDay,
                        powderMonth=info.powderMonth,
                        powderCost=info.powderCost;
                        powderMoney=info.powderMoney;
                        outPowder=info.outPowder,
                        outPowderDay=info.outPowderDay,
                        outPowderMonth=info.outPowderMonth,
                        outPowderMoney=info.outPowderMoney,
                        outPowderCost=info.outPowderCost,
                        patent=info.patent,
                        patentCost=info.patentCost;
                        patentMoney=info.patentMoney,
                        days=info.days;
                        type=info.type;
                        getmedicineSupplier();
                        if(detail == "[]"){
                            $(".caoyao").css("display","none");
                        }
                        if(decoction == "[]"){
                            $(".tangyao").css("display","none");
                        }
                        if(powder == "[]"){
                            $(".fenji").css("display","none");
                        }
                        if(outPowder == "[]"){
                            $(".wfenji").css("display","none");
                        }
                    },
                    error: function () {
                        alert("发生错误");
                    }
                });



                $(".save").on("click",function () {
                    var departId=$("#keshi").val();
                    // console.log(departId);
                    var teamName = $("#teamName").val();
                    var departName=$("#keshi").find("option:selected").text();
                    // console.log(departName);
                    var sendCount=$("#sendCount").val();
                    // console.log(sendCount);
                    var remark=$("#remark").val();
                    // console.log(remark);
                    var paidMoney=$("#paidMoney").val();
                    // console.log(paidMoney);
                    var unPaidMoney=$("#unPaidMoney").val();
                    // console.log(unPaidMoney);
                    var paidTime=$("#paidTime").val();
                    // console.log(paidTime);
                    var payment=$("#payment").val();
                    // console.log(payment);
                    // var receiveProvince=$("#input_province").val();
                    console.log()
                    if($("#country").val()=="domestic"){
                        var receiveProvince=$("#input_province").val();
                        var receiveCity=$("#input_city").val();
                        var receiveArea=$("#input_area").val();
                        var receiveStreet=$("#receiveStreet").val();
                    }else if($("#country").val()=="abroad"){
                        receiveProvince=$("#input_province1").val();
                        receiveCity=$("#input_city1").val();
                        receiveArea=$("#input_area1").val();
                        receiveStreet=$("#receiveStreet1").val();
                    }
                    console.log(receiveProvince);
                    // var receiveCity=$("#input_city").val();
                    console.log(receiveCity);
                    // var receiveArea=$("#input_area").val();
                    console.log(receiveArea);
                    // var receiveStreet=$("#receiveStreet").val();
                    console.log(receiveStreet);
                    var sendProvince=$("#fa_input_province").val();
                    // console.log(sendProvince);
                    var sendCity=$("#fa_input_city").val();
                    // console.log(sendCity);
                    var sendArea=$("#fa_input_area").val();
                    // console.log(sendArea);
                    if($("#sendStreet1").val()==""&&$("#sendStreet").val()!=""){
                        var sendStreet=$("#sendStreet").val();
                    }else if($("#sendStreet").val()==""&&$("#sendStreet1").val()!=""){
                        sendStreet=$("#sendStreet1").val();
                    }else if($("#sendStreet").val()!=""&&$("sendStreet1").val()!=""){
                        sendStreet=$("#sendStreet").val();
                    }else{
                        sendStreet= ""
                    }

                    // console.log(sendStreet);
                    var receiveName=$("#receiveName").val();
                    // console.log(receiveName);
                    var receivePhone=$("#receivePhone").val();
                    // console.log(receivePhone);
                    var powderNum = $("#powderNum").val();
                    var outpowderNum = $("#outpowderNum").val();
                    // console.log(powderNum);
                    var sendNums=$("#sendNums").val();
                    // console.log(sendNums);
                    var sendName=$("#sendName").val();
                    // console.log(sendName);
                    var sendPhone=$("#sendPhone").val();
                    // console.log(sendPhone);
                    var sendId=session_login.info.userId;
                    var herbSpec = $("#detailNum").val();
                    var decoctSpec = $("#decoctionNum").val();
                    var decoctionMl = $("#decoctionMl").val();
                    if(departId==""){
                        alert("科室未填写");
                        return;
                    }

                    if(receiveName==""){
                        alert("收件人姓名未填写");
                        return;
                    }
                    if(receivePhone==""){
                        alert("收件人电话未填写");
                        return;
                    }
                    if(receiveProvince==""){
                        alert("收件人的地址未填写完整");
                        return;
                    }
                    if(receiveCity==""){
                        alert("收件人的地址未填写完整");
                        return;
                    }
                    // if(receiveCity=="东莞市"||receiveCity=="中山市"||receiveCity=="三沙市"||receiveCity=="嘉峪关市"||receiveCity=="儋州市"){
                    //     $("#input_area").css("display","none");
                    // }
                    if(receiveCity!="东莞市"&&receiveCity!="中山市"&&receiveCity!="三沙市"&&receiveCity!="嘉峪关市"&&receiveCity!="儋州市"&&receiveArea==""){
                        alert("收件人的地址未填写完整");
                        return;
                    }
                    if(receiveStreet==""){
                        alert("收件人的地址未填写完整");
                        return;
                    }

                    if(sendName==""){
                        alert("发件人姓名未填写");
                        return;
                    }
                    if(sendPhone==""){
                        alert("发件人手机号未填写");
                        return;
                    }
                    if(sendProvince==""){
                        alert("发件人地址未填写完整");
                        return;
                    }
                    if(sendCity==""){
                        alert("发件人地址未填写完整");
                        return;
                    }
                    if(sendCity!="东莞市"&&sendCity!="中山市"&&sendCity!="三沙市"&&sendCity!="嘉峪关市"&&sendCity!="儋州市"&&sendArea==""){
                        alert("发件人地址未填写完整");
                        return;
                    }
                    if(sendStreet==""){
                        alert("发件人地址未填写完整");
                        return;
                    }

                    if(paidTime==""){
                        alert("付款日期未填写");
                        return;
                    }

                    if(sendCount==""){
                        alert("发药次数未填写");
                        return;
                    }
                    if(sendNums==""){
                        alert("发药次数未填写");
                        return;
                    }
                    if($("#detailNum").val()==""&&JSON.parse(detail).length!=0){
                        alert("请填写草药总数");
                        return;
                    }
                    if($("#decoctionNum").val()==""&&JSON.parse(decoction).length!=0){
                        alert("请填写汤药总数");
                        return;
                    }
                    if(powderNum == ""&&JSON.parse(powder).length!=0){
                        alert("请填写内服粉剂总数");
                        return;
                    }
                    if(outpowderNum == ""&&JSON.parse(outPowder).length!=0){
                        alert("请填写外敷粉剂总数");
                        return;
                    }

                    if(paidMoney==""){
                        alert("已付金额未填写");
                        return;
                    }

                    if(unPaidMoney==""){
                        alert("到付金额未填写");
                        return;
                    }

                    if(payment==""){
                        alert("邮寄方式未填写");
                        return;
                    }



                    // if(departId==""||sendCount==""||sendNums==""||sendPhone==""||sendProvince==""||sendCity==""||sendArea==""||sendStreet==""||paidMoney==""||unPaidMoney==""||paidTime==""||payment==""||receiveProvince==""||receiveCity==""||receiveArea==""||receiveStreet==""||receiveName==""||receivePhone==""){
                    //     alert("除药剂数及备注外所有信息皆为必填项，请仔细检查信息！");
                    //     return;
                    // }
                    var auditor="";
                    var auditId="";
                    $("body").mLoading("show");
                    $.ajax({
                        url: config.rootUrl + "user/addMedInvoice.do",
                        data: {
                            deviceToken: "html5",
                            deviceType: "html5",
                            userId: session_login.info.userId,
                            mrId: mrId,
                            isSimple: 1,
                            hospId: hospId,
                            hospName: hospName,
                            doctorId:doctorId,
                            doctorName:doctorName,
                            departId: departId,
                            departName: departName,
                            sendCount: sendCount,
                            patientName:patientName,
                            remark:remark,
                            sendNums:sendNums,
                            paidMoney:paidMoney,
                            unPaidMoney:unPaidMoney,
                            paidTime:paidTime,
                            payment:payment,
                            receiveProvince:receiveProvince,
                            receiveCity:receiveCity,
                            receiveArea:receiveArea,
                            receiveStreet:receiveStreet,
                            sendProvince:sendProvince,
                            sendCity:sendCity,
                            sendArea:sendArea,
                            sendStreet:sendStreet,
                            receivePhone:receivePhone,
                            receiveName:receiveName,
                            sendId:sendId,
                            sendPhone:sendPhone,
                            decoction:decoction,
                            decoctSpec:decoctSpec,
                            decoctionCost:decoctionCost,
                            decoctionMoney:decoctionMoney,
                            powderMilliliter:decoctionMl,
                            days:days,
                            giveDay:giveDay,
                            herbalCost:herbalCost,
                            herbalMoney:herbalMoney,
                            medicineCost:medicineCost,
                            medicineMoney:medicineMoney,
                            powder:powder,
                            powderNum:powderNum,
                            powderDay:powderDay,
                            powderMonth:powderMonth,
                            outPowderMoney:outPowderMoney,
                            outPowderDay:outPowderDay,
                            outPowderCost:outPowderCost,
                            outPowderMonth:outPowderMonth,
                            outPowderPackage:outpowderNum,
                            powderCost:powderCost,
                            powderMoney:powderMoney,
                            patent:patent,
                            patentCost:patentCost,
                            patentMoney:patentMoney,
                            type:type,
                            sendName:sendName,
                            auditor:auditor,
                            auditId:auditId,

                            sex:sexNeed,
                            dName:dName,
                            illness:illness,
                            detail:detail,
                            herbSpec:herbSpec,
                            discount:discountNeed,
                            discountMoney:discountMoney,
                            decoctMoney:decoctMoney,
                            medicineCost:medicineCost,
                        },
                        async: true,
                        type: 'post',
                        success: function (data) {
                            if (data.code == "1") {
                                alert(data.msg);
                                window.history.go(-1);
                                // window.location.reload();
                            }
                        },
                        error: function (xhr, type, errorThrown) {
                            alert('发生错误！');
                            console.log(xhr + errorThrown);
                        },
                        complete: function () {
                            $("body").mLoading("hide");//关闭loading组件
                        }
                    });
                })
            })
        </script>
</body>

</html>